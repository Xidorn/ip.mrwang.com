<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IP Lookup - Mr Wang</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --accent-color: #7c3aed;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-white: rgba(255, 255, 255, 0.98);
            --shadow-xl: 0 20px 40px -10px rgba(0, 0, 0, 0.08);
            --error-red: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(-45deg, #f0f2f5, #e0e7ff, #f5f3ff, #f0f2f5);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
        }

        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .container { width: 100%; max-width: 600px; text-align: center; }

        header { margin-bottom: 30px; }
        .logo-text {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: -2px;
        }

        .search-wrapper {
            background: var(--bg-white);
            border-radius: 50px;
            padding: 8px 8px 8px 25px;
            display: flex;
            box-shadow: var(--shadow-xl);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            align-items: center;
        }
        
        .search-wrapper.has-error { border-color: var(--error-red); }
        .search-wrapper.is-valid { border-color: var(--primary-color); }

        input {
            flex: 1; border: none; font-size: 1.1rem; outline: none; background: transparent;
            color: var(--text-dark); width: 100%; height: 50px;
        }

        button {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white; border: none; padding: 0 35px; height: 50px; border-radius: 40px;
            font-weight: 600; cursor: not-allowed; transition: all 0.3s; opacity: 0.4;
        }
        
        button.active { opacity: 1; cursor: pointer; }

        .error-msg {
            color: var(--error-red); font-size: 0.85rem; margin-top: 10px;
            height: 20px; visibility: hidden; font-weight: 500;
        }

        .visitor-card {
            background: var(--bg-white); border-radius: 24px; padding: 20px; text-align: left;
            box-shadow: var(--shadow-xl); display: none; animation: fadeIn 0.8s ease forwards; margin-top: 20px;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card-row { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .label { color: var(--text-light); font-size: 0.85rem; text-transform: uppercase; font-weight: 600; }
        .value { color: var(--text-dark); font-weight: 500; }
        .my-ip { color: var(--primary-color); cursor: pointer; text-decoration: underline; font-weight: 700; }

        footer { margin-top: 50px; color: var(--text-light); font-size: 0.85rem; }
        footer a { color: inherit; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1 class="logo-text">Mr Wang</h1>
            <p style="color: var(--text-light); margin-top: 5px; letter-spacing: 2px;">IP.MrWang.Com</p>
        </header>

        <div class="search-wrapper" id="searchBox">
            <input type="text" id="ipInput" placeholder="Enter IPv4 or IPv6 address" autofocus autocomplete="off" spellcheck="false">
            <button id="searchBtn" onclick="goToQuery()" disabled>Search</button>
        </div>
        
        <div id="errorHint" class="error-msg">Please enter a valid IPv4 or IPv6 address</div>

        <div class="visitor-card" id="visitorCard">
            <div class="card-row"><span class="label">Your IP</span><span class="value my-ip" id="v-ip" onclick="useMyIp()">Loading...</span></div>
            <div class="card-row"><span class="label">Location</span><span class="value" id="v-loc">Detecting...</span></div>
            <div class="card-row"><span class="label">ISP</span><span class="value" id="v-isp">...</span></div>
        </div>

        <footer>Â© <span id="year"></span> <a href="https://www.wangxiansheng.com">Mr Wang</a> All Rights Reserved.</footer>
    </div>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        const ipInput = document.getElementById('ipInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchBox = document.getElementById('searchBox');
        const errorHint = document.getElementById('errorHint');

        async function fetchVisitorData() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                document.getElementById('v-ip').textContent = data.ip;
                document.getElementById('v-loc').textContent = `${data.city || 'Unknown'}, ${data.country_name}`;
                document.getElementById('v-isp').textContent = data.org || data.asn;
                document.getElementById('visitorCard').style.display = 'block';
            } catch (e) { console.log('API Error'); }
        }

        function useMyIp() { ipInput.value = document.getElementById('v-ip').textContent; handleInput(); }

        function isValidIP(ip) {
            const v4 = /^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$/;
            const v6 = /^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/;
            return v4.test(ip) || v6.test(ip);
        }

        function handleInput() {
            let val = ipInput.value.replace(/[^0-9a-fA-F.:]/g, '');
            ipInput.value = val;

            if (val === "") {
                errorHint.style.visibility = "hidden";
                searchBox.classList.remove('has-error', 'is-valid');
                searchBtn.disabled = true;
                searchBtn.classList.remove('active');
                return;
            }

            if (isValidIP(val)) {
                errorHint.style.visibility = "hidden";
                searchBox.classList.remove('has-error');
                searchBox.classList.add('is-valid');
                searchBtn.disabled = false;
                searchBtn.classList.add('active');
            } else {
                errorHint.style.visibility = "visible";
                searchBox.classList.add('has-error');
                searchBox.classList.remove('is-valid');
                searchBtn.disabled = true;
                searchBtn.classList.remove('active');
            }
        }

        ipInput.addEventListener('input', handleInput);

        // Updated Query Logic
        function goToQuery() { 
            const ip = ipInput.value.trim();
            if (!searchBtn.disabled && ip) {
                // Redirects to ip.mrwang.com/77.83.241.228
                window.location.href = 'https://ip.mrwang.com/' + ip; 
            } 
        }

        ipInput.addEventListener('keydown', (e) => { 
            if (e.key === 'Enter' && !searchBtn.disabled) goToQuery(); 
        });

        fetchVisitorData();
    </script>
</body>
</html>
